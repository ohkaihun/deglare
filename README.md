# Deglare
this is repository for physics-based scattering model and a glare mitigation algorithm to tackle the challenges posed by scattered glare on imaging applications .
## Cloning the Repository
```shell
# SSH
git clone git@github.com:/ohkaihun/deglare.git --recursive
```
or
```shell
# HTTPS
git clone https://github.com/ohkaihun/deglare --recursive
```
## Data preparation 
To simulate light source with synthetic data, our repository first expect the following dataset structure in the source path location :
```
<location>
|---blender_sim（For spectrum_blender.py ）
    |---scene_path
   	|---cam000.png
    	|---cam001.png
   	|---...
    	|---cam033.png
    	|---cam034.png
    	|---cam035.png
   	|---transforms.json (camera position json file generated by blender)
|---out_path
```
Next, we expect glare image folder with Intensity table around the point light source should follow the dataset structure in the source path location:
```
<location>
|---curve_fit  ( For pipe_prepare_simulatedataset_light.py & pipe_preparedataset_light.py )
    |---images
    	|---cam000.png
    	|---cam001.png
    	|---...
    |---light_curve_simulate
```
## Try to run  Spectrum Simulation
Run Spectrum Simulation: You may specify the location path and output path.
```shell
python spectrum_blender.py  
```
then use script to do glare mitigation for synthetic scene(pipe_prepare_simulatedataset_light with 1 light source) and real scene(pipe_preparedataset_light for 3 light soucres)
```shell
python pipe_preparedataset_light.py
```
## Gaussian Splatting with mask
We expect the gs scene following data structure like this:
```
<location>
|---scene_name
    |---images/images_DEL
    	|---cam000.png
    	|---cam001.png
    	|---...
    |---masks/mask_large
    |---sparse
	|---0
```
Train GS with the script trian.py. We did not modify the reading method of the datasetloader; instead, we added a method to read the mask in the train script.
Please note that the form of  model_path( A_B_C --->A:FULL point_cloud or not/B:FULL input_image or not/C:Use mask or not)
```shell
python gs/train.py  -s  path/to/your/scene/name   --images  images --save_iterations 30_000 --checkpoint_iterations 30_000 --model_path output\scene_name\FUL_FUL_YES 
```
Render GS with the script render.py, where model_path( A_B_C --->A:FULL point_cloud or not/B:FULL IMAGE or not/C:Use mask or not)
```shell
python gs/render.py  -s  path/to/your/scene/name  --images  images  --model_path  output\scene_name\FUL_FUL_YES
```